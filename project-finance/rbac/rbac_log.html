<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>操作日志 - 权限中心</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>tailwind.config = { theme: { extend: { animation: { 'fade-in': 'fadeIn 0.3s ease-out' }, keyframes: { fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } } } } } }</script>
    <script src="../data.js"></script>
    <style>
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        body { overflow-x: hidden; }
    </style>
</head>
<body class="bg-[#F8FAFC]">
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useMemo } = React;
        
        // 使用统一数据
        const LOGS = window.LOGS;

        const IconWrapper = ({ children, size = 18, className = "", ...props }) => (<svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>{children}</svg>);
        const FileText = (p) => <IconWrapper {...p}><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" x2="8" y1="13" y2="13"/><line x1="16" x2="8" y1="17" y2="17"/><polyline points="10 9 9 9 8 9"/></IconWrapper>;
        const Search = (p) => <IconWrapper {...p}><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></IconWrapper>;
        const Download = (p) => <IconWrapper {...p}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></IconWrapper>;
        const RefreshCw = (p) => <IconWrapper {...p}><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/><path d="M16 16h5v5"/></IconWrapper>;
        const Eye = (p) => <IconWrapper {...p}><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></IconWrapper>;
        const X = (p) => <IconWrapper {...p}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></IconWrapper>;
        const ChevronLeft = (p) => <IconWrapper {...p}><path d="m15 18-6-6 6-6"/></IconWrapper>;
        const ChevronRight = (p) => <IconWrapper {...p}><path d="m9 18 6-6-6-6"/></IconWrapper>;



        const getTypeColor = (type) => {
            const colors = {
                create: 'bg-green-100 text-green-700',
                update: 'bg-blue-100 text-blue-700',
                delete: 'bg-red-100 text-red-700',
                view: 'bg-slate-100 text-slate-600',
                export: 'bg-purple-100 text-purple-700',
                login: 'bg-cyan-100 text-cyan-700',
                logout: 'bg-amber-100 text-amber-700',
            };
            return colors[type] || 'bg-slate-100 text-slate-600';
        };

        const getTypeLabel = (type) => {
            const labels = { create: '新增', update: '修改', delete: '删除', view: '查看', export: '导出', login: '登录', logout: '登出' };
            return labels[type] || type;
        };

        const App = () => {
            const [searchText, setSearchText] = useState('');
            const [filterModule, setFilterModule] = useState('');
            const [filterType, setFilterType] = useState('');
            const [filterStatus, setFilterStatus] = useState('');
            const [currentPage, setCurrentPage] = useState(1);
            const [detailModal, setDetailModal] = useState(null);
            const pageSize = 10;

            const modules = [...new Set(LOGS.map(l => l.module))];
            const types = [...new Set(LOGS.map(l => l.type))];

            const filteredLogs = useMemo(() => {
                return LOGS.filter(log => {
                    const matchSearch = !searchText || log.user.includes(searchText) || log.action.includes(searchText) || log.ip.includes(searchText);
                    const matchModule = !filterModule || log.module === filterModule;
                    const matchType = !filterType || log.type === filterType;
                    const matchStatus = !filterStatus || log.status === filterStatus;
                    return matchSearch && matchModule && matchType && matchStatus;
                });
            }, [searchText, filterModule, filterType, filterStatus]);

            const paginatedLogs = useMemo(() => {
                const start = (currentPage - 1) * pageSize;
                return filteredLogs.slice(start, start + pageSize);
            }, [filteredLogs, currentPage]);

            const totalPages = Math.ceil(filteredLogs.length / pageSize);

            const handleExport = () => {
                alert('导出功能：将导出 ' + filteredLogs.length + ' 条日志记录');
            };

            return (
                <div className="p-8 max-w-[1400px] mx-auto animate-fade-in">
                    <div className="mb-8 flex justify-between items-end">
                        <div>
                            <h2 className="text-2xl font-bold text-slate-800 flex items-center gap-3">
                                <div className="w-10 h-10 rounded-xl bg-amber-100 flex items-center justify-center">
                                    <FileText size={20} className="text-amber-600" />
                                </div>
                                操作日志
                            </h2>
                            <p className="text-slate-500 text-sm mt-1 ml-13">记录系统所有用户操作行为，支持审计追溯</p>
                        </div>
                        <button onClick={handleExport} className="px-5 py-2.5 bg-indigo-600 text-white rounded-xl shadow-lg shadow-indigo-200 hover:bg-indigo-700 transition-all flex items-center gap-2 text-sm font-medium">
                            <Download size={18} /> 导出日志
                        </button>
                    </div>

                    {/* 统计卡片 */}
                    <div className="grid grid-cols-5 gap-4 mb-6">
                        <div className="bg-white rounded-xl p-4 border border-slate-100 shadow-sm">
                            <div className="text-slate-500 text-xs mb-1">今日操作</div>
                            <div className="text-2xl font-bold text-slate-800">{LOGS.filter(l => l.time.includes('2025-12-09')).length}</div>
                        </div>
                        <div className="bg-white rounded-xl p-4 border border-slate-100 shadow-sm">
                            <div className="text-slate-500 text-xs mb-1">新增操作</div>
                            <div className="text-2xl font-bold text-green-600">{LOGS.filter(l => l.type === 'create').length}</div>
                        </div>
                        <div className="bg-white rounded-xl p-4 border border-slate-100 shadow-sm">
                            <div className="text-slate-500 text-xs mb-1">修改操作</div>
                            <div className="text-2xl font-bold text-blue-600">{LOGS.filter(l => l.type === 'update').length}</div>
                        </div>
                        <div className="bg-white rounded-xl p-4 border border-slate-100 shadow-sm">
                            <div className="text-slate-500 text-xs mb-1">删除操作</div>
                            <div className="text-2xl font-bold text-red-600">{LOGS.filter(l => l.type === 'delete').length}</div>
                        </div>
                        <div className="bg-white rounded-xl p-4 border border-slate-100 shadow-sm">
                            <div className="text-slate-500 text-xs mb-1">失败操作</div>
                            <div className="text-2xl font-bold text-amber-600">{LOGS.filter(l => l.status === '失败').length}</div>
                        </div>
                    </div>

                    {/* 主内容 */}
                    <div className="bg-white rounded-[2rem] shadow-sm border border-slate-100 overflow-hidden">
                        {/* 筛选栏 */}
                        <div className="p-6 border-b border-slate-100 flex justify-between items-center flex-wrap gap-4">
                            <div className="flex items-center gap-3 flex-wrap">
                                <div className="relative">
                                    <Search size={16} className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400" />
                                    <input type="text" placeholder="搜索用户、操作、IP..." value={searchText} onChange={e => { setSearchText(e.target.value); setCurrentPage(1); }} className="pl-9 pr-4 py-2 bg-slate-50 rounded-xl text-sm w-56 outline-none focus:ring-2 focus:ring-indigo-100" />
                                </div>
                                <select value={filterModule} onChange={e => { setFilterModule(e.target.value); setCurrentPage(1); }} className="px-4 py-2 bg-slate-50 rounded-xl text-sm outline-none">
                                    <option value="">全部模块</option>
                                    {modules.map(m => <option key={m} value={m}>{m}</option>)}
                                </select>
                                <select value={filterType} onChange={e => { setFilterType(e.target.value); setCurrentPage(1); }} className="px-4 py-2 bg-slate-50 rounded-xl text-sm outline-none">
                                    <option value="">全部类型</option>
                                    {types.map(t => <option key={t} value={t}>{getTypeLabel(t)}</option>)}
                                </select>
                                <select value={filterStatus} onChange={e => { setFilterStatus(e.target.value); setCurrentPage(1); }} className="px-4 py-2 bg-slate-50 rounded-xl text-sm outline-none">
                                    <option value="">全部状态</option>
                                    <option value="成功">成功</option>
                                    <option value="失败">失败</option>
                                </select>
                                <button onClick={() => { setSearchText(''); setFilterModule(''); setFilterType(''); setFilterStatus(''); setCurrentPage(1); }} className="p-2 text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg">
                                    <RefreshCw size={16} />
                                </button>
                            </div>
                            <div className="text-sm text-slate-500">共 <span className="font-bold text-indigo-600">{filteredLogs.length}</span> 条记录</div>
                        </div>

                        {/* 表格 */}
                        <div className="overflow-x-auto">
                            <table className="w-full text-sm">
                                <thead className="bg-slate-50 text-slate-500 text-xs uppercase">
                                    <tr>
                                        <th className="px-6 py-4 text-left">时间</th>
                                        <th className="px-6 py-4 text-left">用户</th>
                                        <th className="px-6 py-4 text-left">IP地址</th>
                                        <th className="px-6 py-4 text-left">模块</th>
                                        <th className="px-6 py-4 text-left">操作</th>
                                        <th className="px-6 py-4 text-left">类型</th>
                                        <th className="px-6 py-4 text-left">状态</th>
                                        <th className="px-6 py-4 text-right">详情</th>
                                    </tr>
                                </thead>
                                <tbody className="divide-y divide-slate-50">
                                    {paginatedLogs.map(log => (
                                        <tr key={log.id} className="hover:bg-slate-50 transition-colors">
                                            <td className="px-6 py-4 text-slate-500 text-xs font-mono">{log.time}</td>
                                            <td className="px-6 py-4">
                                                <div className="flex items-center gap-2">
                                                    <div className="w-7 h-7 rounded-full bg-gradient-to-br from-indigo-500 to-purple-500 flex items-center justify-center text-white text-xs font-bold">{log.user[0]}</div>
                                                    <div>
                                                        <div className="font-medium text-slate-700 text-xs">{log.user}</div>
                                                        <div className="text-[10px] text-slate-400">{log.role}</div>
                                                    </div>
                                                </div>
                                            </td>
                                            <td className="px-6 py-4 text-slate-500 font-mono text-xs">{log.ip}</td>
                                            <td className="px-6 py-4 text-slate-600 text-xs">{log.module}</td>
                                            <td className="px-6 py-4 text-slate-700 font-medium text-xs">{log.action}</td>
                                            <td className="px-6 py-4">
                                                <span className={`px-2 py-0.5 rounded text-[10px] font-medium ${getTypeColor(log.type)}`}>{getTypeLabel(log.type)}</span>
                                            </td>
                                            <td className="px-6 py-4">
                                                <span className={`px-2 py-0.5 rounded-full text-[10px] font-medium ${log.status === '成功' ? 'bg-green-50 text-green-600' : 'bg-red-50 text-red-600'}`}>{log.status}</span>
                                            </td>
                                            <td className="px-6 py-4 text-right">
                                                <button onClick={() => setDetailModal(log)} className="p-1.5 text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg"><Eye size={14} /></button>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>

                        {/* 分页 */}
                        <div className="p-4 border-t border-slate-100 flex justify-between items-center">
                            <div className="text-sm text-slate-500">第 {currentPage} / {totalPages} 页</div>
                            <div className="flex gap-2">
                                <button onClick={() => setCurrentPage(p => Math.max(1, p - 1))} disabled={currentPage === 1} className="p-2 rounded-lg border border-slate-200 text-slate-500 hover:bg-slate-50 disabled:opacity-50 disabled:cursor-not-allowed"><ChevronLeft size={16} /></button>
                                {Array.from({ length: Math.min(5, totalPages) }, (_, i) => i + 1).map(page => (
                                    <button key={page} onClick={() => setCurrentPage(page)} className={`w-8 h-8 rounded-lg text-sm font-medium ${currentPage === page ? 'bg-indigo-600 text-white' : 'border border-slate-200 text-slate-600 hover:bg-slate-50'}`}>{page}</button>
                                ))}
                                <button onClick={() => setCurrentPage(p => Math.min(totalPages, p + 1))} disabled={currentPage === totalPages} className="p-2 rounded-lg border border-slate-200 text-slate-500 hover:bg-slate-50 disabled:opacity-50 disabled:cursor-not-allowed"><ChevronRight size={16} /></button>
                            </div>
                        </div>
                    </div>

                    {/* 详情弹窗 */}
                    {detailModal && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-slate-900/40 backdrop-blur-sm animate-fade-in" onClick={() => setDetailModal(null)}>
                            <div className="bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden" onClick={e => e.stopPropagation()}>
                                <div className="px-6 py-4 border-b border-slate-100 flex justify-between items-center bg-slate-50">
                                    <h3 className="text-lg font-bold text-slate-800">日志详情</h3>
                                    <button onClick={() => setDetailModal(null)} className="p-2 hover:bg-slate-200 rounded-full text-slate-400"><X size={20} /></button>
                                </div>
                                <div className="p-6 space-y-4">
                                    <div className="grid grid-cols-2 gap-4">
                                        <div><div className="text-xs text-slate-400 mb-1">日志ID</div><div className="font-mono text-sm">{detailModal.id}</div></div>
                                        <div><div className="text-xs text-slate-400 mb-1">操作时间</div><div className="font-mono text-sm">{detailModal.time}</div></div>
                                        <div><div className="text-xs text-slate-400 mb-1">操作用户</div><div className="text-sm font-medium">{detailModal.user}</div></div>
                                        <div><div className="text-xs text-slate-400 mb-1">用户角色</div><div className="text-sm">{detailModal.role}</div></div>
                                        <div><div className="text-xs text-slate-400 mb-1">IP地址</div><div className="font-mono text-sm">{detailModal.ip}</div></div>
                                        <div><div className="text-xs text-slate-400 mb-1">操作状态</div><div className={`text-sm font-medium ${detailModal.status === '成功' ? 'text-green-600' : 'text-red-600'}`}>{detailModal.status}</div></div>
                                    </div>
                                    <div><div className="text-xs text-slate-400 mb-1">操作模块</div><div className="text-sm">{detailModal.module}</div></div>
                                    <div><div className="text-xs text-slate-400 mb-1">操作行为</div><div className="text-sm font-medium">{detailModal.action}</div></div>
                                    <div><div className="text-xs text-slate-400 mb-1">详细描述</div><div className="text-sm p-3 bg-slate-50 rounded-lg">{detailModal.detail}</div></div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
