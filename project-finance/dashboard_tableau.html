<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>数据可视化看板 - 电商数据中心</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="data.js"></script>
    <style>::-webkit-scrollbar{width:6px;height:6px}::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:3px}</style>
</head>
<body class="bg-[#F8FAFC]">
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useMemo } = React;
        const IconWrapper = ({ children, size = 18, ...props }) => (<svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>{children}</svg>);
        const LayoutDashboard = (p) => <IconWrapper {...p}><rect width="7" height="9" x="3" y="3" rx="1"/><rect width="7" height="5" x="14" y="3" rx="1"/><rect width="7" height="9" x="14" y="12" rx="1"/><rect width="7" height="5" x="3" y="16" rx="1"/></IconWrapper>;
        const TrendingUp = (p) => <IconWrapper {...p}><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></IconWrapper>;
        const TrendingDown = (p) => <IconWrapper {...p}><polyline points="22 17 13.5 8.5 8.5 13.5 2 7"/><polyline points="16 17 22 17 22 11"/></IconWrapper>;
        const Store = (p) => <IconWrapper {...p}><path d="m2 7 4.41-4.41A2 2 0 0 1 7.83 2h8.34a2 2 0 0 1 1.42.59L22 7"/><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/><path d="M15 22v-4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4"/><path d="M2 7h20"/><path d="M22 7v3a2 2 0 0 1-2 2v0a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 16 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 12 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 8 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 4 12v0a2 2 0 0 1-2-2V7"/></IconWrapper>;

        const App = () => {
            const data = window.DASHBOARD_DATA;
            const colors = { platform: ['#6366f1', '#10b981', '#f59e0b'], customer: ['#ef4444', '#3b82f6', '#22c55e'], category: ['#8b5cf6', '#ec4899', '#14b8a6', '#f97316', '#64748b'] };

            const formatNum = (n) => {
                if (Math.abs(n) >= 100000000) return (n / 100000000).toFixed(2) + '亿';
                if (Math.abs(n) >= 10000) return (n / 10000).toFixed(1) + '万';
                return n.toLocaleString();
            };

            // KPI卡片
            const KPICard = ({ label, value, unit, change, isUp }) => (
                <div className="bg-white rounded-xl shadow-sm border border-slate-100 p-4">
                    <div className="text-xs text-slate-500 mb-1">{label}</div>
                    <div className="text-xl font-bold text-slate-800">{typeof value === 'number' && value > 1000 ? formatNum(value) : value}<span className="text-xs font-normal text-slate-400 ml-1">{unit}</span></div>
                    {change !== undefined && (
                        <div className={`flex items-center gap-1 text-xs mt-1 ${isUp ? 'text-green-600' : 'text-red-500'}`}>
                            {isUp ? <TrendingUp size={12} /> : <TrendingDown size={12} />}
                            <span>{isUp ? '+' : ''}{change}%</span>
                        </div>
                    )}
                </div>
            );

            // 月度趋势折线图
            const LineChart = ({ data, height = 180 }) => {
                const maxGmv = Math.max(...data.map(d => d.gmv));
                const maxProfit = Math.max(...data.map(d => d.profit));
                return (
                    <div className="relative" style={{ height }}>
                        <svg className="w-full h-full" viewBox="0 0 100 60" preserveAspectRatio="none">
                            {/* GMV线 */}
                            <polyline fill="none" stroke="#6366f1" strokeWidth="0.8"
                                points={data.map((d, i) => `${i * (100 / (data.length - 1))},${55 - (d.gmv / maxGmv) * 45}`).join(' ')} />
                            {/* 利润线 */}
                            <polyline fill="none" stroke="#10b981" strokeWidth="0.8"
                                points={data.map((d, i) => `${i * (100 / (data.length - 1))},${55 - (d.profit / maxProfit) * 45}`).join(' ')} />
                            {/* 数据点 */}
                            {data.map((d, i) => (
                                <g key={i}>
                                    <circle cx={i * (100 / (data.length - 1))} cy={55 - (d.gmv / maxGmv) * 45} r="1.2" fill="#6366f1" />
                                    <circle cx={i * (100 / (data.length - 1))} cy={55 - (d.profit / maxProfit) * 45} r="1.2" fill="#10b981" />
                                </g>
                            ))}
                        </svg>
                        <div className="absolute bottom-0 left-0 right-0 flex justify-between text-[10px] text-slate-400 px-1">
                            {data.map((d, i) => <span key={i}>{d.month.slice(5)}月</span>)}
                        </div>
                    </div>
                );
            };

            // 店铺排行
            const ShopRanking = ({ shops, limit = 10 }) => {
                const topShops = shops.slice(0, limit);
                const maxGmv = topShops[0]?.gmv || 1;
                return (
                    <div className="space-y-2">
                        {topShops.map((shop, idx) => (
                            <div key={idx} className="flex items-center gap-3">
                                <span className={`w-5 h-5 rounded text-xs flex items-center justify-center font-bold ${idx < 3 ? 'bg-amber-100 text-amber-600' : 'bg-slate-100 text-slate-500'}`}>{idx + 1}</span>
                                <div className="flex-1 min-w-0">
                                    <div className="flex justify-between text-sm mb-1">
                                        <span className="text-slate-700 truncate">{shop.name}</span>
                                        <span className="text-slate-800 font-medium">{formatNum(shop.gmv)}</span>
                                    </div>
                                    <div className="h-2 bg-slate-100 rounded-full overflow-hidden">
                                        <div className="h-full bg-indigo-500 rounded-full" style={{ width: `${(shop.gmv / maxGmv) * 100}%` }}></div>
                                    </div>
                                </div>
                            </div>
                        ))}
                    </div>
                );
            };

            // 品类平台热力图
            const CategoryHeatmap = ({ data }) => {
                const categories = [...new Set(data.map(d => d.category))];
                const platforms = [...new Set(data.map(d => d.platform))];
                const maxVal = Math.max(...data.map(d => d.gmv));
                const getVal = (cat, plat) => data.find(d => d.category === cat && d.platform === plat)?.gmv || 0;
                const getColor = (val) => {
                    const intensity = val / maxVal;
                    if (intensity < 0.3) return 'bg-indigo-100';
                    if (intensity < 0.5) return 'bg-indigo-200';
                    if (intensity < 0.7) return 'bg-indigo-400';
                    return 'bg-indigo-600';
                };
                return (
                    <div>
                        <div className="flex">
                            <div className="w-16"></div>
                            {platforms.map(p => <div key={p} className="flex-1 text-center text-xs text-slate-500 pb-2">{p}</div>)}
                        </div>
                        {categories.map(cat => (
                            <div key={cat} className="flex items-center mb-1">
                                <div className="w-16 text-xs text-slate-500 pr-2 text-right truncate">{cat}</div>
                                {platforms.map(plat => {
                                    const val = getVal(cat, plat);
                                    return (
                                        <div key={plat} className="flex-1 px-0.5">
                                            <div className={`h-8 ${getColor(val)} rounded flex items-center justify-center text-[10px] ${val / maxVal > 0.5 ? 'text-white' : 'text-slate-600'}`} title={`${cat}-${plat}: ${formatNum(val)}`}>
                                                {formatNum(val)}
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        ))}
                    </div>
                );
            };


            // 环形图
            const DonutChart = ({ data, colorKey, size = 140 }) => {
                const total = data.reduce((s, d) => s + d.gmv, 0);
                let cumulative = 0;
                const colorSet = colors[colorKey] || colors.platform;
                return (
                    <div className="flex items-center gap-4">
                        <svg width={size} height={size} viewBox="0 0 100 100">
                            {data.map((item, idx) => {
                                const pct = item.gmv / total;
                                const startAngle = cumulative * 360;
                                cumulative += pct;
                                const endAngle = cumulative * 360;
                                const largeArc = pct > 0.5 ? 1 : 0;
                                const startRad = (startAngle - 90) * Math.PI / 180;
                                const endRad = (endAngle - 90) * Math.PI / 180;
                                const x1 = 50 + 38 * Math.cos(startRad);
                                const y1 = 50 + 38 * Math.sin(startRad);
                                const x2 = 50 + 38 * Math.cos(endRad);
                                const y2 = 50 + 38 * Math.sin(endRad);
                                return <path key={idx} d={`M 50 50 L ${x1} ${y1} A 38 38 0 ${largeArc} 1 ${x2} ${y2} Z`} fill={colorSet[idx % colorSet.length]} className="hover:opacity-80 cursor-pointer" />;
                            })}
                            <circle cx="50" cy="50" r="24" fill="white" />
                            <text x="50" y="48" textAnchor="middle" className="text-[7px] fill-slate-400">总计</text>
                            <text x="50" y="56" textAnchor="middle" className="text-[9px] fill-slate-700 font-bold">{formatNum(total)}</text>
                        </svg>
                        <div className="space-y-1.5 flex-1">
                            {data.map((item, idx) => (
                                <div key={idx} className="flex items-center justify-between text-xs">
                                    <div className="flex items-center gap-1.5">
                                        <span className="w-2.5 h-2.5 rounded" style={{ backgroundColor: colorSet[idx % colorSet.length] }}></span>
                                        <span className="text-slate-600">{item.name}</span>
                                    </div>
                                    <span className="text-slate-700 font-medium">{((item.gmv / total) * 100).toFixed(1)}%</span>
                                </div>
                            ))}
                        </div>
                    </div>
                );
            };

            return (
                <div className="p-6 max-w-[1600px] mx-auto">
                    <div className="mb-6">
                        <h2 className="text-2xl font-bold text-slate-800 flex items-center gap-3">
                            <div className="w-10 h-10 rounded-xl bg-gradient-to-br from-indigo-500 to-purple-500 flex items-center justify-center">
                                <LayoutDashboard size={20} className="text-white" />
                            </div>
                            数据可视化看板
                        </h2>
                        <p className="text-slate-500 text-sm mt-1">电商运营核心指标一览</p>
                    </div>

                    {/* KPI指标行 */}
                    <div className="grid grid-cols-6 gap-3 mb-6">
                        <KPICard label="总GMV" value={data.summary.gmv} unit="元" change={12.5} isUp={true} />
                        <KPICard label="总利润" value={data.summary.profit} unit="元" change={8.3} isUp={true} />
                        <KPICard label="利润率" value={data.summary.profitRate} unit="%" change={2.1} isUp={true} />
                        <KPICard label="总订单" value={data.summary.orders} unit="单" change={15.2} isUp={true} />
                        <KPICard label="访客数" value={data.summary.visitors} unit="人" change={-3.2} isUp={false} />
                        <KPICard label="转化率" value={data.summary.conversionRate} unit="%" change={1.8} isUp={true} />
                    </div>

                    <div className="grid grid-cols-12 gap-4">
                        {/* 月度趋势 */}
                        <div className="col-span-8 bg-white rounded-2xl shadow-sm border border-slate-100 p-5">
                            <div className="flex justify-between items-center mb-4">
                                <h3 className="font-bold text-slate-800">月度趋势</h3>
                                <div className="flex gap-4 text-xs">
                                    <span className="flex items-center gap-1"><span className="w-3 h-1 bg-indigo-500 rounded"></span>GMV</span>
                                    <span className="flex items-center gap-1"><span className="w-3 h-1 bg-emerald-500 rounded"></span>利润</span>
                                </div>
                            </div>
                            <LineChart data={data.byMonth} height={200} />
                        </div>

                        {/* 平台占比 */}
                        <div className="col-span-4 bg-white rounded-2xl shadow-sm border border-slate-100 p-5">
                            <h3 className="font-bold text-slate-800 mb-4">平台GMV占比</h3>
                            <DonutChart data={data.byPlatform} colorKey="platform" />
                        </div>

                        {/* 客户占比 */}
                        <div className="col-span-4 bg-white rounded-2xl shadow-sm border border-slate-100 p-5">
                            <h3 className="font-bold text-slate-800 mb-4">客户GMV占比</h3>
                            <DonutChart data={data.byCustomer} colorKey="customer" />
                        </div>

                        {/* 品类占比 */}
                        <div className="col-span-4 bg-white rounded-2xl shadow-sm border border-slate-100 p-5">
                            <h3 className="font-bold text-slate-800 mb-4">品类GMV占比</h3>
                            <DonutChart data={data.byCategory} colorKey="category" size={130} />
                        </div>

                        {/* 部门业绩 */}
                        <div className="col-span-4 bg-white rounded-2xl shadow-sm border border-slate-100 p-5">
                            <h3 className="font-bold text-slate-800 mb-4">部门业绩</h3>
                            <div className="space-y-3">
                                {data.byDepartment.map((dept, idx) => {
                                    const maxGmv = Math.max(...data.byDepartment.map(d => d.gmv));
                                    return (
                                        <div key={idx}>
                                            <div className="flex justify-between text-sm mb-1">
                                                <span className="text-slate-600">{dept.name}</span>
                                                <span className="text-slate-800 font-medium">{formatNum(dept.gmv)}</span>
                                            </div>
                                            <div className="h-3 bg-slate-100 rounded-full overflow-hidden">
                                                <div className="h-full bg-gradient-to-r from-indigo-500 to-purple-500 rounded-full" style={{ width: `${(dept.gmv / maxGmv) * 100}%` }}></div>
                                            </div>
                                            <div className="flex justify-between text-xs text-slate-400 mt-1">
                                                <span>利润: {formatNum(dept.profit)}</span>
                                                <span>利润率: {dept.profitRate}%</span>
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        </div>

                        {/* 品类-平台热力图 */}
                        <div className="col-span-5 bg-white rounded-2xl shadow-sm border border-slate-100 p-5">
                            <h3 className="font-bold text-slate-800 mb-4">品类-平台GMV热力图</h3>
                            <CategoryHeatmap data={data.categoryPlatform} />
                            <div className="flex items-center justify-end gap-2 mt-3 text-[10px] text-slate-400">
                                <span>低</span>
                                <div className="flex gap-0.5">
                                    <span className="w-4 h-3 bg-indigo-100 rounded-sm"></span>
                                    <span className="w-4 h-3 bg-indigo-200 rounded-sm"></span>
                                    <span className="w-4 h-3 bg-indigo-400 rounded-sm"></span>
                                    <span className="w-4 h-3 bg-indigo-600 rounded-sm"></span>
                                </div>
                                <span>高</span>
                            </div>
                        </div>

                        {/* 店铺排行 */}
                        <div className="col-span-7 bg-white rounded-2xl shadow-sm border border-slate-100 p-5">
                            <div className="flex items-center gap-2 mb-4">
                                <Store size={18} className="text-amber-500" />
                                <h3 className="font-bold text-slate-800">店铺GMV排行 TOP10</h3>
                            </div>
                            <ShopRanking shops={data.shopRanking} limit={10} />
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>