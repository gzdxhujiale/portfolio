<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>对比分析看板 - 电商数据中心</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="data.js"></script>
    <style>::-webkit-scrollbar{width:6px;height:6px}::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:3px}</style>
</head>
<body class="bg-[#F8FAFC]">
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useMemo } = React;
        const IconWrapper = ({ children, size = 18, ...props }) => (<svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>{children}</svg>);
        const GitCompare = (p) => <IconWrapper {...p}><circle cx="18" cy="18" r="3"/><circle cx="6" cy="6" r="3"/><path d="M13 6h3a2 2 0 0 1 2 2v7"/><path d="M11 18H8a2 2 0 0 1-2-2V9"/></IconWrapper>;
        const TrendingUp = (p) => <IconWrapper {...p}><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></IconWrapper>;
        const TrendingDown = (p) => <IconWrapper {...p}><polyline points="22 17 13.5 8.5 8.5 13.5 2 7"/><polyline points="16 17 22 17 22 11"/></IconWrapper>;

        const App = () => {
            const data = window.DASHBOARD_DATA;
            const [dimension, setDimension] = useState('platform'); // platform, customer, department, category
            const [metric, setMetric] = useState('gmv'); // gmv, profit, orders, profitRate

            const dimensionData = useMemo(() => {
                const map = { platform: data.byPlatform, customer: data.byCustomer, department: data.byDepartment, category: data.byCategory };
                return map[dimension] || [];
            }, [dimension, data]);

            const dimensionLabels = { platform: '平台', customer: '客户', department: '部门', category: '品类' };
            const metricLabels = { gmv: 'GMV', profit: '利润', orders: '订单数', profitRate: '利润率%' };
            const colors = ['#6366f1', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6'];

            const maxVal = Math.max(...dimensionData.map(d => Math.abs(d[metric])));
            const total = dimensionData.reduce((s, d) => s + (metric === 'profitRate' ? 0 : d[metric]), 0);

            // 月度趋势
            const monthlyData = data.byMonth;
            const monthMax = Math.max(...monthlyData.map(m => m[metric === 'profitRate' ? 'gmv' : metric]));

            const formatNum = (n) => {
                if (Math.abs(n) >= 100000000) return (n / 100000000).toFixed(2) + '亿';
                if (Math.abs(n) >= 10000) return (n / 10000).toFixed(1) + '万';
                return n.toLocaleString();
            };

            return (
                <div className="p-6 max-w-[1600px] mx-auto">
                    <div className="mb-6 flex justify-between items-start">
                        <div>
                            <h2 className="text-2xl font-bold text-slate-800 flex items-center gap-3">
                                <div className="w-10 h-10 rounded-xl bg-indigo-100 flex items-center justify-center"><GitCompare size={20} className="text-indigo-600" /></div>
                                对比分析看板
                            </h2>
                            <p className="text-slate-500 text-sm mt-1">多维度数据对比分析 · 平台/客户/部门/品类</p>
                        </div>
                        <div className="flex gap-3">
                            <select value={dimension} onChange={e => setDimension(e.target.value)} className="px-4 py-2 bg-white border border-slate-200 rounded-xl text-sm focus:ring-2 focus:ring-indigo-100 outline-none">
                                <option value="platform">按平台</option>
                                <option value="customer">按客户</option>
                                <option value="department">按部门</option>
                                <option value="category">按品类</option>
                            </select>
                            <select value={metric} onChange={e => setMetric(e.target.value)} className="px-4 py-2 bg-white border border-slate-200 rounded-xl text-sm focus:ring-2 focus:ring-indigo-100 outline-none">
                                <option value="gmv">GMV</option>
                                <option value="profit">利润</option>
                                <option value="orders">订单数</option>
                                <option value="profitRate">利润率</option>
                            </select>
                        </div>
                    </div>

                    {/* 汇总卡片 */}
                    <div className="grid grid-cols-4 gap-4 mb-6">
                        {[
                            { label: '总GMV', value: data.summary.gmv, unit: '元' },
                            { label: '总利润', value: data.summary.profit, unit: '元' },
                            { label: '总订单', value: data.summary.orders, unit: '单' },
                            { label: '平均利润率', value: data.summary.profitRate, unit: '%', isRate: true },
                        ].map((item, i) => (
                            <div key={i} className="bg-white rounded-xl shadow-sm border border-slate-100 p-5">
                                <div className="text-sm text-slate-500">{item.label}</div>
                                <div className="text-2xl font-bold text-slate-800 mt-1">
                                    {item.isRate ? item.value : formatNum(item.value)}
                                    <span className="text-sm font-normal text-slate-400 ml-1">{item.unit}</span>
                                </div>
                            </div>
                        ))}
                    </div>

                    <div className="grid grid-cols-12 gap-6">
                        {/* 维度对比柱状图 */}
                        <div className="col-span-7 bg-white rounded-2xl shadow-sm border border-slate-100 p-6">
                            <h3 className="font-bold text-slate-800 mb-4">{dimensionLabels[dimension]}对比 - {metricLabels[metric]}</h3>
                            <div className="space-y-4">
                                {dimensionData.map((item, idx) => {
                                    const val = item[metric];
                                    const pct = Math.abs(val) / maxVal * 100;
                                    const isNeg = val < 0;
                                    return (
                                        <div key={idx}>
                                            <div className="flex justify-between text-sm mb-1">
                                                <span className="text-slate-600 font-medium">{item.name}</span>
                                                <span className={`font-bold ${isNeg ? 'text-red-500' : 'text-slate-800'}`}>
                                                    {metric === 'profitRate' ? val + '%' : formatNum(val)}
                                                </span>
                                            </div>
                                            <div className="h-8 bg-slate-100 rounded-lg overflow-hidden relative">
                                                <div className={`h-full rounded-lg transition-all ${isNeg ? 'bg-red-400' : ''}`} style={{ width: `${pct}%`, backgroundColor: isNeg ? undefined : colors[idx % colors.length] }}>
                                                    {metric !== 'profitRate' && total > 0 && (
                                                        <span className="absolute right-2 top-1/2 -translate-y-1/2 text-xs text-slate-500">
                                                            {((val / total) * 100).toFixed(1)}%
                                                        </span>
                                                    )}
                                                </div>
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        </div>

                        {/* 占比饼图 */}
                        <div className="col-span-5 bg-white rounded-2xl shadow-sm border border-slate-100 p-6">
                            <h3 className="font-bold text-slate-800 mb-4">{dimensionLabels[dimension]}占比分布</h3>
                            <div className="flex items-center gap-6">
                                <svg width="160" height="160" viewBox="0 0 100 100">
                                    {(() => {
                                        const validData = dimensionData.filter(d => d[metric] > 0);
                                        const pieTotal = validData.reduce((s, d) => s + d[metric], 0);
                                        let cumulative = 0;
                                        return validData.map((item, idx) => {
                                            const pct = item[metric] / pieTotal;
                                            const startAngle = cumulative * 360;
                                            cumulative += pct;
                                            const endAngle = cumulative * 360;
                                            const largeArc = pct > 0.5 ? 1 : 0;
                                            const startRad = (startAngle - 90) * Math.PI / 180;
                                            const endRad = (endAngle - 90) * Math.PI / 180;
                                            const x1 = 50 + 40 * Math.cos(startRad);
                                            const y1 = 50 + 40 * Math.sin(startRad);
                                            const x2 = 50 + 40 * Math.cos(endRad);
                                            const y2 = 50 + 40 * Math.sin(endRad);
                                            return <path key={idx} d={`M 50 50 L ${x1} ${y1} A 40 40 0 ${largeArc} 1 ${x2} ${y2} Z`} fill={colors[idx % colors.length]} className="hover:opacity-80 cursor-pointer" />;
                                        });
                                    })()}
                                    <circle cx="50" cy="50" r="22" fill="white" />
                                </svg>
                                <div className="space-y-2 flex-1">
                                    {dimensionData.map((item, idx) => (
                                        <div key={idx} className="flex items-center justify-between text-sm">
                                            <div className="flex items-center gap-2">
                                                <span className="w-3 h-3 rounded" style={{ backgroundColor: colors[idx % colors.length] }}></span>
                                                <span className="text-slate-600">{item.name}</span>
                                            </div>
                                            <span className="text-slate-800 font-medium">{metric === 'profitRate' ? item[metric] + '%' : formatNum(item[metric])}</span>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>

                        {/* 月度趋势 */}
                        <div className="col-span-12 bg-white rounded-2xl shadow-sm border border-slate-100 p-6">
                            <h3 className="font-bold text-slate-800 mb-4">月度趋势 - {metricLabels[metric]}</h3>
                            <div className="h-48 flex items-end gap-2">
                                {monthlyData.map((m, idx) => {
                                    const val = metric === 'profitRate' ? (m.profit / m.gmv * 100) : m[metric];
                                    const h = (Math.abs(val) / (metric === 'profitRate' ? 30 : monthMax)) * 100;
                                    return (
                                        <div key={idx} className="flex-1 flex flex-col items-center">
                                            <div className="text-xs text-slate-500 mb-1">{metric === 'profitRate' ? val.toFixed(1) + '%' : formatNum(val)}</div>
                                            <div className="w-full bg-indigo-500 rounded-t transition-all hover:bg-indigo-600" style={{ height: `${Math.max(h, 2)}%` }}></div>
                                            <div className="text-xs text-slate-400 mt-2">{m.month.slice(5)}</div>
                                        </div>
                                    );
                                })}
                            </div>
                        </div>

                        {/* 详细数据表格 */}
                        <div className="col-span-12 bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
                            <div className="p-5 border-b border-slate-100"><h3 className="font-bold text-slate-800">{dimensionLabels[dimension]}详细数据</h3></div>
                            <div className="overflow-x-auto">
                                <table className="w-full text-sm">
                                    <thead className="bg-slate-50">
                                        <tr>
                                            <th className="px-6 py-3 text-left font-medium text-slate-600">{dimensionLabels[dimension]}</th>
                                            <th className="px-6 py-3 text-right font-medium text-slate-600">GMV</th>
                                            <th className="px-6 py-3 text-right font-medium text-slate-600">成本</th>
                                            <th className="px-6 py-3 text-right font-medium text-slate-600">利润</th>
                                            <th className="px-6 py-3 text-right font-medium text-slate-600">利润率</th>
                                            <th className="px-6 py-3 text-right font-medium text-slate-600">订单数</th>
                                            <th className="px-6 py-3 text-center font-medium text-slate-600">趋势</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {dimensionData.map((item, idx) => (
                                            <tr key={idx} className="border-t border-slate-100 hover:bg-slate-50">
                                                <td className="px-6 py-4 font-medium text-slate-800">{item.name}</td>
                                                <td className="px-6 py-4 text-right">{formatNum(item.gmv)}</td>
                                                <td className="px-6 py-4 text-right">{formatNum(item.cost)}</td>
                                                <td className={`px-6 py-4 text-right font-medium ${item.profit >= 0 ? 'text-green-600' : 'text-red-500'}`}>{formatNum(item.profit)}</td>
                                                <td className={`px-6 py-4 text-right ${parseFloat(item.profitRate) >= 10 ? 'text-green-600' : 'text-amber-500'}`}>{item.profitRate}%</td>
                                                <td className="px-6 py-4 text-right">{item.orders.toLocaleString()}</td>
                                                <td className="px-6 py-4 text-center">
                                                    {item.profit >= 0 ? <TrendingUp size={16} className="inline text-green-500" /> : <TrendingDown size={16} className="inline text-red-500" />}
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>