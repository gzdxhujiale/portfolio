<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>角色管理 - 权限中心</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>tailwind.config = { theme: { extend: { animation: { 'fade-in': 'fadeIn 0.3s ease-out', 'slide-up': 'slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1)' }, keyframes: { fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } }, slideUp: { '0%': { transform: 'translateY(20px)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' } } } } } }</script>
    <style>
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        body { overflow-x: hidden; }
    </style>
</head>
<body class="bg-[#F8FAFC]">
    <div id="root"></div>
    <script type="text/babel">
        const { useState } = React;

        // 图标组件
        const IconWrapper = ({ children, size = 18, className = "", ...props }) => (<svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>{children}</svg>);
        const Shield = (p) => <IconWrapper {...p}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"/></IconWrapper>;
        const Plus = (p) => <IconWrapper {...p}><path d="M5 12h14"/><path d="M12 5v14"/></IconWrapper>;
        const Edit = (p) => <IconWrapper {...p}><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></IconWrapper>;
        const Trash2 = (p) => <IconWrapper {...p}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></IconWrapper>;
        const X = (p) => <IconWrapper {...p}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></IconWrapper>;
        const Users = (p) => <IconWrapper {...p}><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></IconWrapper>;
        const Settings = (p) => <IconWrapper {...p}><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></IconWrapper>;
        const Check = (p) => <IconWrapper {...p}><polyline points="20 6 9 17 4 12"/></IconWrapper>;

        // 角色数据
        const INITIAL_ROLES = [
            { id: 1, name: '超级管理员', code: 'SUPER_ADMIN', desc: '拥有系统所有权限，可管理所有模块和用户', userCount: 1, status: '启用', isSystem: true, color: 'red', permissions: ['all'] },
            { id: 2, name: '运维工程师', code: 'OPS_ENGINEER', desc: '负责系统运维、监控告警、日志管理等', userCount: 2, status: '启用', isSystem: true, color: 'purple', permissions: ['system:monitor', 'system:log', 'config:view'] },
            { id: 3, name: '数据质量管理员', code: 'DATA_QUALITY', desc: '负责数据质量监控、异常数据处理、数据校验规则配置', userCount: 3, status: '启用', isSystem: true, color: 'blue', permissions: ['data:quality', 'data:validate', 'report:view'] },
            { id: 4, name: '数据资产管理员', code: 'DATA_ASSET', desc: '负责数据资产目录、元数据管理、数据血缘维护', userCount: 2, status: '启用', isSystem: true, color: 'cyan', permissions: ['data:asset', 'data:meta', 'data:lineage'] },
            { id: 5, name: '财务BI', code: 'FINANCE_BI', desc: '查看财务相关报表、公司经营仓、预算监控等', userCount: 5, status: '启用', isSystem: true, color: 'green', permissions: ['report:company', 'report:budget', 'report:export'] },
            { id: 6, name: '业务BI', code: 'BUSINESS_BI', desc: '查看业务相关报表、店铺经营仓、阿米巴报表等', userCount: 8, status: '启用', isSystem: true, color: 'amber', permissions: ['report:store', 'report:ameba', 'report:export'] },
            { id: 7, name: '高层管理者', code: 'EXECUTIVE', desc: '查看所有经营数据、关键指标看板、决策支持报表', userCount: 3, status: '启用', isSystem: true, color: 'indigo', permissions: ['report:all', 'dashboard:executive', 'export:all'] },
        ];

        const PERMISSION_GROUPS = [
            { name: '报表权限', permissions: [
                { code: 'report:company', name: '公司经营仓' },
                { code: 'report:ameba', name: '阿米巴经营仓' },
                { code: 'report:store', name: '店铺经营仓' },
                { code: 'report:budget', name: '预算监控' },
                { code: 'report:export', name: '报表导出' },
                { code: 'report:all', name: '所有报表' },
            ]},
            { name: '数据权限', permissions: [
                { code: 'data:quality', name: '数据质量' },
                { code: 'data:validate', name: '数据校验' },
                { code: 'data:asset', name: '数据资产' },
                { code: 'data:meta', name: '元数据管理' },
                { code: 'data:lineage', name: '数据血缘' },
            ]},
            { name: '系统权限', permissions: [
                { code: 'system:monitor', name: '系统监控' },
                { code: 'system:log', name: '日志管理' },
                { code: 'config:view', name: '配置查看' },
                { code: 'config:edit', name: '配置编辑' },
                { code: 'user:manage', name: '用户管理' },
                { code: 'role:manage', name: '角色管理' },
            ]},
        ];

        const getColorClass = (color) => {
            const colors = {
                red: { bg: 'bg-red-500', light: 'bg-red-100', text: 'text-red-600', border: 'border-red-200' },
                purple: { bg: 'bg-purple-500', light: 'bg-purple-100', text: 'text-purple-600', border: 'border-purple-200' },
                blue: { bg: 'bg-blue-500', light: 'bg-blue-100', text: 'text-blue-600', border: 'border-blue-200' },
                cyan: { bg: 'bg-cyan-500', light: 'bg-cyan-100', text: 'text-cyan-600', border: 'border-cyan-200' },
                green: { bg: 'bg-green-500', light: 'bg-green-100', text: 'text-green-600', border: 'border-green-200' },
                amber: { bg: 'bg-amber-500', light: 'bg-amber-100', text: 'text-amber-600', border: 'border-amber-200' },
                indigo: { bg: 'bg-indigo-500', light: 'bg-indigo-100', text: 'text-indigo-600', border: 'border-indigo-200' },
            };
            return colors[color] || colors.indigo;
        };

        const App = () => {
            const [roles, setRoles] = useState(INITIAL_ROLES);
            const [selectedRole, setSelectedRole] = useState(null);
            const [modal, setModal] = useState({ open: false, data: null });

            const handleSave = (formData) => {
                if (formData.id) {
                    setRoles(prev => prev.map(r => r.id === formData.id ? { ...r, ...formData } : r));
                } else {
                    setRoles(prev => [...prev, { ...formData, id: Date.now(), userCount: 0, isSystem: false }]);
                }
                setModal({ open: false, data: null });
            };

            const handleDelete = (id) => {
                const role = roles.find(r => r.id === id);
                if (role?.isSystem) {
                    alert('系统内置角色不可删除');
                    return;
                }
                if (confirm('确定要删除该角色吗？')) {
                    setRoles(prev => prev.filter(r => r.id !== id));
                }
            };

            return (
                <div className="p-8 max-w-[1400px] mx-auto animate-fade-in">
                    <div className="mb-8 flex justify-between items-end">
                        <div>
                            <h2 className="text-2xl font-bold text-slate-800 flex items-center gap-3">
                                <div className="w-10 h-10 rounded-xl bg-purple-100 flex items-center justify-center">
                                    <Shield size={20} className="text-purple-600" />
                                </div>
                                角色管理
                            </h2>
                            <p className="text-slate-500 text-sm mt-1 ml-13">定义系统角色、配置角色权限</p>
                        </div>
                        <button onClick={() => setModal({ open: true, data: null })} className="px-5 py-2.5 bg-indigo-600 text-white rounded-xl shadow-lg shadow-indigo-200 hover:bg-indigo-700 transition-all flex items-center gap-2 text-sm font-medium">
                            <Plus size={18} /> 新增角色
                        </button>
                    </div>

                    <div className="grid grid-cols-12 gap-6">
                        {/* 角色列表 */}
                        <div className="col-span-5 bg-white rounded-[2rem] shadow-sm border border-slate-100 overflow-hidden">
                            <div className="p-6 border-b border-slate-100">
                                <h3 className="font-bold text-slate-800">角色列表</h3>
                                <p className="text-xs text-slate-400 mt-1">点击角色查看详情</p>
                            </div>
                            <div className="divide-y divide-slate-50 max-h-[600px] overflow-y-auto">
                                {roles.map(role => {
                                    const colorClass = getColorClass(role.color);
                                    return (
                                        <div 
                                            key={role.id} 
                                            onClick={() => setSelectedRole(role)}
                                            className={`p-4 cursor-pointer transition-all hover:bg-slate-50 ${selectedRole?.id === role.id ? 'bg-indigo-50 border-l-4 border-indigo-500' : ''}`}
                                        >
                                            <div className="flex items-center gap-3">
                                                <div className={`w-10 h-10 rounded-xl ${colorClass.light} flex items-center justify-center`}>
                                                    <Shield size={18} className={colorClass.text} />
                                                </div>
                                                <div className="flex-1 min-w-0">
                                                    <div className="flex items-center gap-2">
                                                        <span className="font-medium text-slate-800">{role.name}</span>
                                                        {role.isSystem && <span className="px-1.5 py-0.5 bg-slate-100 text-slate-500 text-[10px] rounded">内置</span>}
                                                    </div>
                                                    <div className="text-xs text-slate-400 truncate">{role.desc}</div>
                                                </div>
                                                <div className="text-right">
                                                    <div className="flex items-center gap-1 text-slate-500">
                                                        <Users size={14} />
                                                        <span className="text-sm font-medium">{role.userCount}</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        </div>

                        {/* 角色详情 */}
                        <div className="col-span-7 bg-white rounded-[2rem] shadow-sm border border-slate-100 overflow-hidden">
                            {selectedRole ? (
                                <>
                                    <div className="p-6 border-b border-slate-100 flex justify-between items-center">
                                        <div className="flex items-center gap-3">
                                            <div className={`w-12 h-12 rounded-xl ${getColorClass(selectedRole.color).light} flex items-center justify-center`}>
                                                <Shield size={24} className={getColorClass(selectedRole.color).text} />
                                            </div>
                                            <div>
                                                <h3 className="font-bold text-slate-800 text-lg">{selectedRole.name}</h3>
                                                <p className="text-xs text-slate-400">{selectedRole.code}</p>
                                            </div>
                                        </div>
                                        <div className="flex gap-2">
                                            <button onClick={() => setModal({ open: true, data: selectedRole })} className="px-4 py-2 text-indigo-600 bg-indigo-50 rounded-lg text-sm font-medium hover:bg-indigo-100 flex items-center gap-1">
                                                <Edit size={14} /> 编辑
                                            </button>
                                            {!selectedRole.isSystem && (
                                                <button onClick={() => handleDelete(selectedRole.id)} className="px-4 py-2 text-red-600 bg-red-50 rounded-lg text-sm font-medium hover:bg-red-100 flex items-center gap-1">
                                                    <Trash2 size={14} /> 删除
                                                </button>
                                            )}
                                        </div>
                                    </div>
                                    <div className="p-6">
                                        <div className="mb-6">
                                            <div className="text-sm text-slate-500 mb-2">角色描述</div>
                                            <p className="text-slate-700">{selectedRole.desc}</p>
                                        </div>
                                        <div className="mb-6">
                                            <div className="text-sm text-slate-500 mb-3">权限配置</div>
                                            {selectedRole.permissions.includes('all') ? (
                                                <div className="p-4 bg-red-50 rounded-xl border border-red-100 text-red-600 text-sm flex items-center gap-2">
                                                    <Shield size={16} /> 该角色拥有系统所有权限
                                                </div>
                                            ) : (
                                                <div className="space-y-4">
                                                    {PERMISSION_GROUPS.map(group => (
                                                        <div key={group.name} className="border border-slate-100 rounded-xl p-4">
                                                            <div className="text-sm font-medium text-slate-700 mb-3">{group.name}</div>
                                                            <div className="flex flex-wrap gap-2">
                                                                {group.permissions.map(perm => {
                                                                    const hasPermission = selectedRole.permissions.includes(perm.code);
                                                                    return (
                                                                        <span key={perm.code} className={`px-3 py-1.5 rounded-lg text-xs font-medium flex items-center gap-1 ${hasPermission ? 'bg-green-100 text-green-700 border border-green-200' : 'bg-slate-50 text-slate-400 border border-slate-100'}`}>
                                                                            {hasPermission && <Check size={12} />}
                                                                            {perm.name}
                                                                        </span>
                                                                    );
                                                                })}
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                </>
                            ) : (
                                <div className="h-full flex items-center justify-center text-slate-400 p-20">
                                    <div className="text-center">
                                        <Shield size={48} className="mx-auto mb-4 opacity-30" />
                                        <p>请从左侧选择一个角色查看详情</p>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>

                    {/* 弹窗 */}
                    {modal.open && <RoleModal data={modal.data} onClose={() => setModal({ open: false, data: null })} onSave={handleSave} />}
                </div>
            );
        };

        const RoleModal = ({ data, onClose, onSave }) => {
            const [form, setForm] = useState(data || { name: '', code: '', desc: '', color: 'indigo', status: '启用', permissions: [] });
            const colors = ['red', 'purple', 'blue', 'cyan', 'green', 'amber', 'indigo'];

            const togglePermission = (code) => {
                setForm(prev => ({
                    ...prev,
                    permissions: prev.permissions.includes(code) ? prev.permissions.filter(p => p !== code) : [...prev.permissions, code]
                }));
            };

            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center bg-slate-900/40 backdrop-blur-sm animate-fade-in" onClick={onClose}>
                    <div className="bg-white rounded-2xl shadow-2xl w-full max-w-2xl overflow-hidden animate-slide-up" onClick={e => e.stopPropagation()}>
                        <div className="px-6 py-4 border-b border-slate-100 flex justify-between items-center bg-slate-50">
                            <h3 className="text-lg font-bold text-slate-800">{data ? '编辑角色' : '新增角色'}</h3>
                            <button onClick={onClose} className="p-2 hover:bg-slate-200 rounded-full text-slate-400"><X size={20} /></button>
                        </div>
                        <div className="p-6 space-y-4 max-h-[70vh] overflow-y-auto">
                            <div className="grid grid-cols-2 gap-4">
                                <div>
                                    <label className="block text-sm font-medium text-slate-600 mb-1">角色名称</label>
                                    <input type="text" value={form.name} onChange={e => setForm({...form, name: e.target.value})} className="w-full px-3 py-2 border border-slate-200 rounded-lg text-sm focus:ring-2 focus:ring-indigo-100 outline-none" />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-slate-600 mb-1">角色编码</label>
                                    <input type="text" value={form.code} onChange={e => setForm({...form, code: e.target.value})} className="w-full px-3 py-2 border border-slate-200 rounded-lg text-sm focus:ring-2 focus:ring-indigo-100 outline-none" placeholder="如: FINANCE_BI" />
                                </div>
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-slate-600 mb-1">角色描述</label>
                                <textarea value={form.desc} onChange={e => setForm({...form, desc: e.target.value})} rows={2} className="w-full px-3 py-2 border border-slate-200 rounded-lg text-sm focus:ring-2 focus:ring-indigo-100 outline-none resize-none" />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-slate-600 mb-2">角色颜色</label>
                                <div className="flex gap-2">
                                    {colors.map(c => (
                                        <button key={c} onClick={() => setForm({...form, color: c})} className={`w-8 h-8 rounded-lg ${getColorClass(c).bg} ${form.color === c ? 'ring-2 ring-offset-2 ring-slate-400' : ''}`} />
                                    ))}
                                </div>
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-slate-600 mb-3">权限配置</label>
                                <div className="space-y-3">
                                    {PERMISSION_GROUPS.map(group => (
                                        <div key={group.name} className="border border-slate-100 rounded-xl p-3">
                                            <div className="text-xs font-medium text-slate-500 mb-2">{group.name}</div>
                                            <div className="flex flex-wrap gap-2">
                                                {group.permissions.map(perm => (
                                                    <button key={perm.code} onClick={() => togglePermission(perm.code)} className={`px-3 py-1.5 rounded-lg text-xs font-medium transition-all ${form.permissions.includes(perm.code) ? 'bg-indigo-100 text-indigo-700 border border-indigo-200' : 'bg-slate-50 text-slate-500 border border-slate-200 hover:bg-slate-100'}`}>
                                                        {perm.name}
                                                    </button>
                                                ))}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                        <div className="px-6 py-4 bg-slate-50 border-t border-slate-100 flex justify-end gap-3">
                            <button onClick={onClose} className="px-5 py-2 text-slate-600 text-sm font-medium hover:bg-white rounded-lg border border-slate-200">取消</button>
                            <button onClick={() => onSave(form)} className="px-5 py-2 bg-indigo-600 text-white text-sm font-medium rounded-lg hover:bg-indigo-700 shadow-md">保存</button>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
