<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智能对比分析 - 电商数据中心</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="../data.js"></script>
    <style>
        ::-webkit-scrollbar{width:6px;height:6px}
        ::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:3px}
        .drill-breadcrumb { display: flex; align-items: center; gap: 8px; }
        .drill-breadcrumb-item { cursor: pointer; transition: all 0.2s; }
        .drill-breadcrumb-item:hover { color: #6366f1; }
    </style>
</head>
<body class="bg-[#F8FAFC]">
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useMemo, useEffect, useRef } = React;
        
        // 图标组件
        const IconWrapper = ({ children, size = 18, ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" 
                 fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" 
                 strokeLinejoin="round" {...props}>{children}</svg>
        );
        const GitCompare = (p) => <IconWrapper {...p}><circle cx="18" cy="18" r="3"/><circle cx="6" cy="6" r="3"/><path d="M13 6h3a2 2 0 0 1 2 2v7"/><path d="M11 18H8a2 2 0 0 1-2-2V9"/></IconWrapper>;
        const BarChart = (p) => <IconWrapper {...p}><line x1="12" x2="12" y1="20" y2="10"/><line x1="18" x2="18" y1="20" y2="4"/><line x1="6" x2="6" y1="20" y2="14"/></IconWrapper>;
        const Table = (p) => <IconWrapper {...p}><path d="M12 3v18"/><rect width="18" height="18" x="3" y="3" rx="2"/><path d="M3 9h18"/><path d="M3 15h18"/></IconWrapper>;
        const Check = (p) => <IconWrapper {...p}><polyline points="20 6 9 17 4 12"/></IconWrapper>;
        const TrendingUp = (p) => <IconWrapper {...p}><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></IconWrapper>;
        const TrendingDown = (p) => <IconWrapper {...p}><polyline points="23 18 13.5 8.5 8.5 13.5 1 6"/><polyline points="17 18 23 18 23 12"/></IconWrapper>;
        const Target = (p) => <IconWrapper {...p}><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></IconWrapper>;
        const Radar = (p) => <IconWrapper {...p}><path d="m13.11 7.664 1.78 2.672"/><path d="m14.162 12.788-3.324 1.424"/><path d="m20.414 20.414-1.823-1.823"/><path d="M6.603 6.603 3.38 3.38"/><path d="M9.5 2v5"/><path d="M9.5 14v7"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/><circle cx="16" cy="16" r="2"/></IconWrapper>;
        const Filter2 = (p) => <IconWrapper {...p}><path d="M3 6h18l-7 10v5l-4 2v-7L3 6z"/></IconWrapper>;
        const ChevronRight = (p) => <IconWrapper {...p}><path d="m9 18 6-6-6-6"/></IconWrapper>;
        const Home = (p) => <IconWrapper {...p}><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></IconWrapper>;
        
        const COLORS = ['#6366f1', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6', '#ec4899', '#14b8a6', '#f97316'];

        // 配置常量
        const DIMENSIONS = [
            { id: 'customer', name: '客户', drillDown: 'platform' },
            { id: 'platform', name: '平台', drillDown: 'shopName' },
            { id: 'shopName', name: '店铺', drillDown: null },
            { id: 'department', name: '部门', drillDown: null },
            { id: 'month', name: '月份', drillDown: null },
        ];
        
        const MEASURES = [
            { id: 'gmv', name: 'GMV', unit: '元', hasTarget: true },
            { id: 'cost', name: '成本', unit: '元', hasTarget: false },
            { id: 'profit', name: '利润', unit: '元', hasTarget: true },
            { id: 'orders', name: '订单数', unit: '单', hasTarget: true },
            { id: 'visitors', name: '访客数', unit: '人', hasTarget: false },
            { id: 'conversionRate', name: '转化率', unit: '%', hasTarget: false },
        ];
        
        const VIEW_MODES = [
            { id: 'chart', name: '柱状图', icon: BarChart },
            { id: 'table', name: '表格', icon: Table },
            { id: 'radar', name: '雷达图', icon: Radar },
            { id: 'funnel', name: '漏斗', icon: Filter2 },
        ];

        const App = () => {
            const rawData = window.MOCK_DATA || [];
            
            // 状态管理
            const [dimension, setDimension] = useState('customer');
            const [selectedItems, setSelectedItems] = useState([]);
            const [selectedMeasures, setSelectedMeasures] = useState(['gmv', 'profit', 'orders']);
            const [viewMode, setViewMode] = useState('chart');
            const [compareMode, setCompareMode] = useState('current'); // current | yoy | mom | target
            const [drillPath, setDrillPath] = useState([]); // 下钻路径 [{dim, value}, ...]
            
            const radarRef = useRef(null);
            const radarChartRef = useRef(null);

            // 获取当前维度的所有值
            const dimValues = useMemo(() => {
                let filteredData = rawData;
                // 应用下钻筛选
                drillPath.forEach(({ dim, value }) => {
                    filteredData = filteredData.filter(r => r[dim] === value);
                });
                return [...new Set(filteredData.map(r => r[dimension]))].sort();
            }, [rawData, dimension, drillPath]);
            
            // 切换维度时重置选择
            const handleDimensionChange = (newDim) => { 
                setDimension(newDim); 
                setSelectedItems([]); 
            };
            
            // 切换选中项
            const toggleItem = (item) => setSelectedItems(prev => 
                prev.includes(item) ? prev.filter(i => i !== item) : [...prev, item]
            );
            
            // 切换度量
            const toggleMeasure = (id) => setSelectedMeasures(prev => 
                prev.includes(id) ? prev.filter(m => m !== id) : [...prev, id]
            );
            
            // 全选/取消
            const selectAll = () => setSelectedItems(
                selectedItems.length === dimValues.length ? [] : [...dimValues]
            );
            
            // 下钻功能
            const handleDrillDown = (value) => {
                const currentDim = DIMENSIONS.find(d => d.id === dimension);
                if (!currentDim?.drillDown) return;
                
                setDrillPath([...drillPath, { dim: dimension, value }]);
                setDimension(currentDim.drillDown);
                setSelectedItems([]);
            };
            
            // 上钻功能
            const handleDrillUp = (index) => {
                if (index === -1) {
                    // 回到顶层
                    setDrillPath([]);
                    setDimension('customer');
                } else {
                    // 回到指定层级
                    const newPath = drillPath.slice(0, index + 1);
                    setDrillPath(newPath);
                    const targetDim = DIMENSIONS.find(d => d.id === drillPath[index].dim);
                    setDimension(targetDim?.drillDown || 'customer');
                }
                setSelectedItems([]);
            };

            // 聚合对比数据（支持同比/环比/目标对比）
            const compareData = useMemo(() => {
                if (selectedItems.length === 0) return [];
                
                let filteredData = rawData;
                // 应用下钻筛选
                drillPath.forEach(({ dim, value }) => {
                    filteredData = filteredData.filter(r => r[dim] === value);
                });
                
                const grouped = {};
                filteredData.forEach(row => {
                    const key = row[dimension];
                    if (!selectedItems.includes(key)) return;
                    
                    if (!grouped[key]) {
                        grouped[key] = { 
                            name: key, 
                            gmv: 0, cost: 0, profit: 0, orders: 0, visitors: 0, 
                            conversionRate: 0, _count: 0 
                        };
                    }
                    grouped[key].gmv += row.gmv || 0;
                    grouped[key].cost += row.cost || 0;
                    grouped[key].profit += row.profit || 0;
                    grouped[key].orders += row.orders || 0;
                    grouped[key].visitors += row.visitors || 0;
                    grouped[key]._count++;
                });
                
                // 计算转化率
                const result = Object.values(grouped).map(g => ({
                    ...g,
                    conversionRate: g.visitors > 0 ? ((g.orders / g.visitors) * 100).toFixed(2) : 0,
                    profitRate: g.gmv > 0 ? ((g.profit / g.gmv) * 100).toFixed(1) : '0'
                }));
                
                // 添加对比数据（同比/环比/目标）
                if (compareMode !== 'current') {
                    result.forEach(item => {
                        if (compareMode === 'target') {
                            // 模拟目标数据（实际应从后端获取）
                            item.gmvTarget = item.gmv * (0.9 + Math.random() * 0.3);
                            item.profitTarget = item.profit * (0.85 + Math.random() * 0.4);
                            item.ordersTarget = item.orders * (0.9 + Math.random() * 0.25);
                            item.gmvRate = ((item.gmv / item.gmvTarget) * 100).toFixed(1);
                            item.profitRate = ((item.profit / item.profitTarget) * 100).toFixed(1);
                            item.ordersRate = ((item.orders / item.ordersTarget) * 100).toFixed(1);
                        }
                        // 同比/环比逻辑可以类似实现
                    });
                }
                
                return result;
            }, [rawData, dimension, selectedItems, drillPath, compareMode]);
            
            const formatNum = (n) => {
                if (n === undefined || n === null) return '-';
                if (Math.abs(n) >= 100000000) return (n / 100000000).toFixed(2) + '亿';
                if (Math.abs(n) >= 10000) return (n / 10000).toFixed(1) + '万';
                return n.toLocaleString();
            };

            // 雷达图渲染
            useEffect(() => {
                if (viewMode !== 'radar' || compareData.length === 0 || !radarRef.current) return;
                
                // 销毁旧图表
                if (radarChartRef.current) {
                    radarChartRef.current.destroy();
                }
                
                const ctx = radarRef.current.getContext('2d');
                const labels = selectedMeasures.map(m => MEASURES.find(me => me.id === m)?.name || m);
                
                const datasets = compareData.slice(0, 5).map((item, idx) => {
                    const data = selectedMeasures.map(m => {
                        const val = item[m] || 0;
                        // 归一化到0-100
                        const maxVal = Math.max(...compareData.map(d => d[m] || 0), 1);
                        return (val / maxVal) * 100;
                    });
                    
                    return {
                        label: item.name,
                        data: data,
                        borderColor: COLORS[idx % COLORS.length],
                        backgroundColor: COLORS[idx % COLORS.length] + '20',
                        borderWidth: 2,
                    };
                });
                
                radarChartRef.current = new Chart(ctx, {
                    type: 'radar',
                    data: { labels, datasets },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            r: {
                                beginAtZero: true,
                                max: 100,
                                ticks: { display: false },
                                grid: { color: '#e2e8f0' },
                            }
                        },
                        plugins: {
                            legend: { position: 'bottom' }
                        }
                    }
                });
                
                return () => {
                    if (radarChartRef.current) {
                        radarChartRef.current.destroy();
                    }
                };
            }, [viewMode, compareData, selectedMeasures]);

            // 渲染漏斗图
            const renderFunnel = () => {
                if (compareData.length === 0) return (
                    <div className="h-full flex items-center justify-center text-slate-400">
                        <div className="text-center">
                            <Filter2 size={48} className="mx-auto mb-4 opacity-30" />
                            <p>请选择要对比的{DIMENSIONS.find(d => d.id === dimension)?.name}</p>
                        </div>
                    </div>
                );
                
                // 漏斗阶段：访客 -> 订单 -> GMV
                const funnelStages = ['visitors', 'orders', 'gmv'];
                const stageNames = ['访客数', '订单数', 'GMV'];
                
                return (
                    <div className="p-6 space-y-8">
                        {compareData.slice(0, 3).map((item, itemIdx) => {
                            const maxVal = Math.max(item.visitors, item.orders, item.gmv / 100);
                            
                            return (
                                <div key={itemIdx} className="bg-white rounded-xl p-6 border border-slate-100">
                                    <h4 className="font-bold text-slate-700 mb-4 flex items-center gap-2">
                                        <span className="w-3 h-3 rounded-full" style={{ backgroundColor: COLORS[itemIdx % COLORS.length] }}></span>
                                        {item.name} - 转化漏斗
                                    </h4>
                                    <div className="space-y-3">
                                        {funnelStages.map((stage, idx) => {
                                            const val = stage === 'gmv' ? item[stage] / 100 : item[stage];
                                            const width = (val / maxVal) * 100;
                                            const nextVal = idx < funnelStages.length - 1 
                                                ? (funnelStages[idx + 1] === 'gmv' ? item[funnelStages[idx + 1]] / 100 : item[funnelStages[idx + 1]])
                                                : 0;
                                            const convRate = nextVal > 0 ? ((nextVal / val) * 100).toFixed(1) : '-';
                                            
                                            return (
                                                <div key={idx}>
                                                    <div className="flex items-center justify-between mb-1">
                                                        <span className="text-sm font-medium text-slate-600">{stageNames[idx]}</span>
                                                        <span className="text-sm font-bold text-slate-800">{formatNum(item[stage])}</span>
                                                    </div>
                                                    <div className="relative h-12 bg-slate-100 rounded-lg overflow-hidden">
                                                        <div 
                                                            className="absolute inset-y-0 left-0 rounded-lg transition-all"
                                                            style={{ 
                                                                width: `${width}%`, 
                                                                background: `linear-gradient(90deg, ${COLORS[itemIdx % COLORS.length]}, ${COLORS[itemIdx % COLORS.length]}dd)`
                                                            }}
                                                        ></div>
                                                        {idx < funnelStages.length - 1 && (
                                                            <div className="absolute inset-0 flex items-center justify-center text-xs font-medium text-slate-600">
                                                                转化率: {convRate}%
                                                            </div>
                                                        )}
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                );
            };

            // 渲染柱状图
            const renderChart = () => {
                if (compareData.length === 0) return (
                    <div className="h-full flex items-center justify-center text-slate-400">
                        <div className="text-center">
                            <GitCompare size={48} className="mx-auto mb-4 opacity-30" />
                            <p>请选择要对比的{DIMENSIONS.find(d => d.id === dimension)?.name}</p>
                        </div>
                    </div>
                );
                
                return (
                    <div className="p-6 space-y-8">
                        {selectedMeasures.map(meaId => {
                            const mea = MEASURES.find(m => m.id === meaId);
                            const maxVal = Math.max(...compareData.map(d => Math.abs(d[meaId] || 0)), 1);
                            
                            return (
                                <div key={meaId}>
                                    <h4 className="font-medium text-slate-700 mb-4 flex items-center gap-2">
                                        {mea.name}对比
                                        {compareMode === 'target' && mea.hasTarget && (
                                            <span className="text-xs text-slate-400">(含目标完成率)</span>
                                        )}
                                    </h4>
                                    <div className="flex items-end gap-4 h-48">
                                        {compareData.map((item, idx) => {
                                            const val = item[meaId] || 0;
                                            const h = (Math.abs(val) / maxVal) * 100;
                                            const targetRate = compareMode === 'target' && mea.hasTarget 
                                                ? item[`${meaId}Rate`] 
                                                : null;
                                            
                                            return (
                                                <div key={idx} className="flex-1 flex flex-col items-center h-full justify-end group">
                                                    <div className="text-sm font-medium text-slate-700 mb-1">{formatNum(val)}</div>
                                                    {targetRate && (
                                                        <div className={`text-xs mb-1 flex items-center gap-1 ${targetRate >= 100 ? 'text-green-600' : 'text-orange-600'}`}>
                                                            {targetRate >= 100 ? <TrendingUp size={12} /> : <TrendingDown size={12} />}
                                                            {targetRate}%
                                                        </div>
                                                    )}
                                                    <div 
                                                        className={`w-full max-w-[80px] rounded-t transition-all hover:opacity-80 cursor-pointer ${val < 0 ? 'bg-red-400' : ''}`} 
                                                        style={{ 
                                                            height: `${Math.max(h, 3)}%`, 
                                                            backgroundColor: val >= 0 ? COLORS[idx % COLORS.length] : undefined 
                                                        }}
                                                        onClick={() => handleDrillDown(item.name)}
                                                    ></div>
                                                    <div className="text-sm text-slate-500 mt-3 text-center">{item.name}</div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                );
            };

            // 渲染表格
            const renderTable = () => {
                if (compareData.length === 0) return (
                    <div className="h-full flex items-center justify-center text-slate-400">
                        <div className="text-center">
                            <Table size={48} className="mx-auto mb-4 opacity-30" />
                            <p>请选择要对比的{DIMENSIONS.find(d => d.id === dimension)?.name}</p>
                        </div>
                    </div>
                );
                
                return (
                    <div className="overflow-auto">
                        <table className="w-full text-sm">
                            <thead className="bg-slate-50 sticky top-0">
                                <tr>
                                    <th className="px-6 py-4 text-left font-medium text-slate-600">
                                        {DIMENSIONS.find(d => d.id === dimension)?.name}
                                    </th>
                                    {selectedMeasures.map(meaId => {
                                        const mea = MEASURES.find(m => m.id === meaId);
                                        return (
                                            <th key={meaId} className="px-6 py-4 text-right font-medium text-slate-600">
                                                {mea.name}
                                                {compareMode === 'target' && mea.hasTarget && (
                                                    <div className="text-xs text-slate-400 font-normal">完成率</div>
                                                )}
                                            </th>
                                        );
                                    })}
                                </tr>
                            </thead>
                            <tbody>
                                {compareData.map((item, idx) => (
                                    <tr key={idx} className="border-t border-slate-100 hover:bg-slate-50 cursor-pointer" onClick={() => handleDrillDown(item.name)}>
                                        <td className="px-6 py-4 font-medium text-slate-800 flex items-center gap-2">
                                            <span className="w-3 h-3 rounded" style={{ backgroundColor: COLORS[idx % COLORS.length] }}></span>
                                            {item.name}
                                        </td>
                                        {selectedMeasures.map(meaId => {
                                            const mea = MEASURES.find(m => m.id === meaId);
                                            const targetRate = compareMode === 'target' && mea.hasTarget ? item[`${meaId}Rate`] : null;
                                            
                                            return (
                                                <td key={meaId} className={`px-6 py-4 text-right font-medium ${meaId === 'profit' && item[meaId] < 0 ? 'text-red-500' : 'text-slate-800'}`}>
                                                    <div>{formatNum(item[meaId])}</div>
                                                    {targetRate && (
                                                        <div className={`text-xs mt-1 ${targetRate >= 100 ? 'text-green-600' : 'text-orange-600'}`}>
                                                            {targetRate}%
                                                        </div>
                                                    )}
                                                </td>
                                            );
                                        })}
                                    </tr>
                                ))}
                                <tr className="border-t-2 border-slate-200 bg-slate-50 font-bold">
                                    <td className="px-6 py-4 text-slate-700">合计</td>
                                    {selectedMeasures.map(meaId => (
                                        <td key={meaId} className="px-6 py-4 text-right text-slate-800">
                                            {formatNum(compareData.reduce((s, d) => s + (d[meaId] || 0), 0))}
                                        </td>
                                    ))}
                                </tr>
                            </tbody>
                        </table>
                    </div>
                );
            };

            return (
                <div className="p-6 max-w-[1800px] mx-auto">
                    {/* 标题和下钻面包屑 */}
                    <div className="mb-6">
                        <div className="flex items-center justify-between">
                            <div>
                                <h2 className="text-2xl font-bold text-slate-800 flex items-center gap-3">
                                    <div className="w-10 h-10 rounded-xl bg-indigo-100 flex items-center justify-center">
                                        <GitCompare size={20} className="text-indigo-600" />
                                    </div>
                                    智能对比分析
                                </h2>
                                <p className="text-slate-500 text-sm mt-1">多维对比 · 三级下钻 · 同环比分析 · 目标完成率</p>
                            </div>
                            
                            {/* 对比模式切换 */}
                            <div className="flex gap-2">
                                {[
                                    { id: 'current', name: '当前值', icon: BarChart },
                                    { id: 'target', name: '目标完成率', icon: Target },
                                ].map(mode => (
                                    <button
                                        key={mode.id}
                                        onClick={() => setCompareMode(mode.id)}
                                        className={`px-4 py-2 rounded-lg text-sm font-medium flex items-center gap-2 transition-all ${
                                            compareMode === mode.id 
                                                ? 'bg-indigo-100 text-indigo-700 border-2 border-indigo-300' 
                                                : 'bg-white text-slate-600 border-2 border-slate-200 hover:border-slate-300'
                                        }`}
                                    >
                                        <mode.icon size={16} />
                                        {mode.name}
                                    </button>
                                ))}
                            </div>
                        </div>
                        
                        {/* 下钻面包屑 */}
                        {drillPath.length > 0 && (
                            <div className="mt-4 flex items-center gap-2 text-sm bg-white rounded-lg px-4 py-2 border border-slate-200">
                                <Home size={14} className="text-slate-400" />
                                <span 
                                    className="text-indigo-600 cursor-pointer hover:underline"
                                    onClick={() => handleDrillUp(-1)}
                                >
                                    全部
                                </span>
                                {drillPath.map((item, idx) => (
                                    <React.Fragment key={idx}>
                                        <ChevronRight size={14} className="text-slate-400" />
                                        <span 
                                            className="text-slate-600 cursor-pointer hover:text-indigo-600 hover:underline"
                                            onClick={() => handleDrillUp(idx)}
                                        >
                                            {item.value}
                                        </span>
                                    </React.Fragment>
                                ))}
                                <ChevronRight size={14} className="text-slate-400" />
                                <span className="text-slate-800 font-medium">
                                    {DIMENSIONS.find(d => d.id === dimension)?.name}
                                </span>
                            </div>
                        )}
                    </div>

                    <div className="grid grid-cols-12 gap-6">
                        {/* 左侧配置面板 */}
                        <div className="col-span-3 space-y-4">
                            {/* 维度选择 */}
                            <div className="bg-white rounded-2xl shadow-sm border border-slate-100 p-5">
                                <h3 className="font-bold text-slate-700 mb-3">选择维度</h3>
                                <div className="space-y-2">
                                    {DIMENSIONS.map(dim => (
                                        <button 
                                            key={dim.id} 
                                            onClick={() => handleDimensionChange(dim.id)} 
                                            className={`w-full px-4 py-2.5 rounded-xl text-sm font-medium text-left transition-all flex items-center justify-between ${
                                                dimension === dim.id 
                                                    ? 'bg-indigo-100 text-indigo-700 border-2 border-indigo-300' 
                                                    : 'bg-slate-50 text-slate-600 border-2 border-transparent hover:bg-slate-100'
                                            }`}
                                        >
                                            <span>{dim.name}</span>
                                            {dim.drillDown && dimension === dim.id && (
                                                <span className="text-xs text-indigo-500">可下钻</span>
                                            )}
                                        </button>
                                    ))}
                                </div>
                            </div>

                            {/* 数据项选择 */}
                            <div className="bg-white rounded-2xl shadow-sm border border-slate-100 p-5">
                                <div className="flex justify-between items-center mb-3">
                                    <h3 className="font-bold text-slate-700">选择对比项</h3>
                                    <button onClick={selectAll} className="text-xs text-indigo-600 hover:text-indigo-700">
                                        {selectedItems.length === dimValues.length ? '取消全选' : '全选'}
                                    </button>
                                </div>
                                <div className="space-y-1 max-h-64 overflow-y-auto">
                                    {dimValues.map((val, idx) => {
                                        const selected = selectedItems.includes(val);
                                        return (
                                            <button 
                                                key={val} 
                                                onClick={() => toggleItem(val)} 
                                                className={`w-full px-3 py-2 rounded-lg text-sm text-left flex items-center gap-2 transition-all ${
                                                    selected ? 'bg-indigo-50 text-indigo-700' : 'text-slate-600 hover:bg-slate-50'
                                                }`}
                                            >
                                                <span className={`w-4 h-4 rounded border-2 flex items-center justify-center ${
                                                    selected ? 'bg-indigo-500 border-indigo-500' : 'border-slate-300'
                                                }`}>
                                                    {selected && <Check size={12} className="text-white" />}
                                                </span>
                                                <span className="w-2 h-2 rounded-full" style={{ backgroundColor: COLORS[idx % COLORS.length] }}></span>
                                                {val}
                                            </button>
                                        );
                                    })}
                                </div>
                                <div className="mt-3 pt-3 border-t border-slate-100 text-xs text-slate-400">
                                    已选择 {selectedItems.length} / {dimValues.length} 项
                                </div>
                            </div>

                            {/* 度量选择 */}
                            <div className="bg-white rounded-2xl shadow-sm border border-slate-100 p-5">
                                <h3 className="font-bold text-slate-700 mb-3">选择度量</h3>
                                <div className="space-y-1">
                                    {MEASURES.map(mea => {
                                        const selected = selectedMeasures.includes(mea.id);
                                        return (
                                            <button 
                                                key={mea.id} 
                                                onClick={() => toggleMeasure(mea.id)} 
                                                className={`w-full px-3 py-2 rounded-lg text-sm text-left flex items-center gap-2 transition-all ${
                                                    selected ? 'bg-green-50 text-green-700' : 'text-slate-600 hover:bg-slate-50'
                                                }`}
                                            >
                                                <span className={`w-4 h-4 rounded border-2 flex items-center justify-center ${
                                                    selected ? 'bg-green-500 border-green-500' : 'border-slate-300'
                                                }`}>
                                                    {selected && <Check size={12} className="text-white" />}
                                                </span>
                                                <span className="flex-1">{mea.name}</span>
                                                {mea.hasTarget && compareMode === 'target' && (
                                                    <Target size={12} className="text-green-500" />
                                                )}
                                            </button>
                                        );
                                    })}
                                </div>
                            </div>
                        </div>

                        {/* 右侧展示区 */}
                        <div className="col-span-9">
                            {/* 视图切换 */}
                            <div className="bg-white rounded-2xl shadow-sm border border-slate-100 mb-4">
                                <div className="flex border-b border-slate-100">
                                    {VIEW_MODES.map(mode => (
                                        <button 
                                            key={mode.id}
                                            onClick={() => setViewMode(mode.id)} 
                                            className={`flex-1 px-6 py-3 text-sm font-medium flex items-center justify-center gap-2 transition-all ${
                                                viewMode === mode.id 
                                                    ? 'text-indigo-600 border-b-2 border-indigo-600 bg-indigo-50/50' 
                                                    : 'text-slate-500 hover:text-slate-700'
                                            }`}
                                        >
                                            <mode.icon size={18} />
                                            {mode.name}
                                        </button>
                                    ))}
                                </div>
                                <div className="min-h-[500px]">
                                    {viewMode === 'chart' && renderChart()}
                                    {viewMode === 'table' && renderTable()}
                                    {viewMode === 'radar' && (
                                        <div className="p-6 h-[500px]">
                                            {compareData.length === 0 ? (
                                                <div className="h-full flex items-center justify-center text-slate-400">
                                                    <div className="text-center">
                                                        <Radar size={48} className="mx-auto mb-4 opacity-30" />
                                                        <p>请选择要对比的{DIMENSIONS.find(d => d.id === dimension)?.name}</p>
                                                    </div>
                                                </div>
                                            ) : (
                                                <canvas ref={radarRef}></canvas>
                                            )}
                                        </div>
                                    )}
                                    {viewMode === 'funnel' && renderFunnel()}
                                </div>
                            </div>

                            {/* 汇总卡片 */}
                            {compareData.length > 0 && (
                                <div className="grid grid-cols-6 gap-4">
                                    {MEASURES.map(mea => {
                                        const total = compareData.reduce((s, d) => s + (d[mea.id] || 0), 0);
                                        const isSelected = selectedMeasures.includes(mea.id);
                                        
                                        return (
                                            <div 
                                                key={mea.id} 
                                                className={`bg-white rounded-xl shadow-sm border p-4 transition-all ${
                                                    isSelected ? 'border-green-200 bg-green-50/30' : 'border-slate-100'
                                                }`}
                                            >
                                                <div className="text-xs text-slate-500">{mea.name}合计</div>
                                                <div className={`text-xl font-bold mt-1 ${
                                                    mea.id === 'profit' && total < 0 ? 'text-red-500' : 'text-slate-800'
                                                }`}>
                                                    {formatNum(total)}
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };
        
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
