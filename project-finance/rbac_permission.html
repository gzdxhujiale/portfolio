<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>权限管理 - 权限中心</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>tailwind.config = { theme: { extend: { animation: { 'fade-in': 'fadeIn 0.3s ease-out' }, keyframes: { fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } } } } } }</script>
    <style>
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        body { overflow-x: hidden; }
    </style>
</head>
<body class="bg-[#F8FAFC]">
    <div id="root"></div>
    <script type="text/babel">
        const { useState } = React;

        const IconWrapper = ({ children, size = 18, className = "", ...props }) => (<svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>{children}</svg>);
        const Key = (p) => <IconWrapper {...p}><circle cx="7.5" cy="15.5" r="5.5"/><path d="m21 2-9.3 9.3"/><path d="m17 6 4 4"/></IconWrapper>;
        const ChevronRight = (p) => <IconWrapper {...p}><path d="m9 18 6-6-6-6"/></IconWrapper>;
        const ChevronDown = (p) => <IconWrapper {...p}><path d="m6 9 6 6 6-6"/></IconWrapper>;
        const Check = (p) => <IconWrapper {...p}><polyline points="20 6 9 17 4 12"/></IconWrapper>;
        const Folder = (p) => <IconWrapper {...p}><path d="M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z"/></IconWrapper>;
        const File = (p) => <IconWrapper {...p}><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></IconWrapper>;
        const Search = (p) => <IconWrapper {...p}><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></IconWrapper>;

        // 权限树数据
        const PERMISSION_TREE = [
            { id: 'report', name: '数据分析', icon: 'folder', children: [
                { id: 'report:center', name: '经营仓中心', icon: 'file', type: 'menu' },
                { id: 'report:company', name: '公司经营仓', icon: 'file', type: 'menu', children: [
                    { id: 'report:company:view', name: '查看', type: 'action' },
                    { id: 'report:company:export', name: '导出', type: 'action' },
                ]},
                { id: 'report:ameba', name: '阿米巴经营仓', icon: 'file', type: 'menu', children: [
                    { id: 'report:ameba:view', name: '查看', type: 'action' },
                    { id: 'report:ameba:export', name: '导出', type: 'action' },
                ]},
                { id: 'report:store', name: '店铺经营仓', icon: 'file', type: 'menu', children: [
                    { id: 'report:store:view', name: '查看', type: 'action' },
                    { id: 'report:store:export', name: '导出', type: 'action' },
                ]},
                { id: 'report:bi', name: '数据看板', icon: 'file', type: 'menu', children: [
                    { id: 'report:bi:view', name: '查看', type: 'action' },
                    { id: 'report:bi:edit', name: '编辑', type: 'action' },
                    { id: 'report:bi:export', name: '导出', type: 'action' },
                ]},
            ]},
            { id: 'workspace', name: '工作台', icon: 'folder', children: [
                { id: 'workspace:todo', name: '待办清单', icon: 'file', type: 'menu', children: [
                    { id: 'workspace:todo:view', name: '查看', type: 'action' },
                    { id: 'workspace:todo:edit', name: '编辑', type: 'action' },
                ]},
                { id: 'workspace:history', name: '历史记录', icon: 'file', type: 'menu', children: [
                    { id: 'workspace:history:view', name: '查看', type: 'action' },
                ]},
            ]},
            { id: 'rbac', name: '权限中心', icon: 'folder', children: [
                { id: 'rbac:user', name: '用户管理', icon: 'file', type: 'menu', children: [
                    { id: 'rbac:user:view', name: '查看', type: 'action' },
                    { id: 'rbac:user:add', name: '新增', type: 'action' },
                    { id: 'rbac:user:edit', name: '编辑', type: 'action' },
                    { id: 'rbac:user:delete', name: '删除', type: 'action' },
                ]},
                { id: 'rbac:role', name: '角色管理', icon: 'file', type: 'menu', children: [
                    { id: 'rbac:role:view', name: '查看', type: 'action' },
                    { id: 'rbac:role:add', name: '新增', type: 'action' },
                    { id: 'rbac:role:edit', name: '编辑', type: 'action' },
                    { id: 'rbac:role:delete', name: '删除', type: 'action' },
                ]},
                { id: 'rbac:permission', name: '权限管理', icon: 'file', type: 'menu', children: [
                    { id: 'rbac:permission:view', name: '查看', type: 'action' },
                    { id: 'rbac:permission:edit', name: '编辑', type: 'action' },
                ]},
                { id: 'rbac:log', name: '操作日志', icon: 'file', type: 'menu', children: [
                    { id: 'rbac:log:view', name: '查看', type: 'action' },
                    { id: 'rbac:log:export', name: '导出', type: 'action' },
                ]},
                { id: 'rbac:apply', name: '权限申请', icon: 'file', type: 'menu', children: [
                    { id: 'rbac:apply:view', name: '查看', type: 'action' },
                    { id: 'rbac:apply:approve', name: '审批', type: 'action' },
                ]},
            ]},
            { id: 'config', name: '系统设置', icon: 'folder', children: [
                { id: 'config:management', name: '配置管理', icon: 'file', type: 'menu', children: [
                    { id: 'config:management:view', name: '查看', type: 'action' },
                    { id: 'config:management:edit', name: '编辑', type: 'action' },
                ]},
            ]},
        ];

        const ROLES = [
            { id: 1, name: '超级管理员', permissions: ['all'] },
            { id: 2, name: '运维工程师', permissions: ['rbac:log:view', 'rbac:log:export', 'config:management:view'] },
            { id: 3, name: '数据质量管理员', permissions: ['report:center', 'report:company:view', 'report:ameba:view', 'report:store:view', 'workspace:todo:view', 'workspace:history:view'] },
            { id: 4, name: '数据资产管理员', permissions: ['report:center', 'report:company:view', 'report:company:export', 'config:management:view', 'config:management:edit'] },
            { id: 5, name: '财务BI', permissions: ['report:center', 'report:company:view', 'report:company:export', 'report:bi:view', 'report:bi:export'] },
            { id: 6, name: '业务BI', permissions: ['report:center', 'report:ameba:view', 'report:ameba:export', 'report:store:view', 'report:store:export', 'report:bi:view'] },
            { id: 7, name: '高层管理者', permissions: ['report:center', 'report:company:view', 'report:company:export', 'report:ameba:view', 'report:ameba:export', 'report:store:view', 'report:store:export', 'report:bi:view', 'report:bi:export'] },
        ];

        const App = () => {
            const [selectedRole, setSelectedRole] = useState(ROLES[0]);
            const [expandedNodes, setExpandedNodes] = useState(['report', 'workspace', 'rbac', 'config']);
            const [searchText, setSearchText] = useState('');

            const toggleExpand = (id) => {
                setExpandedNodes(prev => prev.includes(id) ? prev.filter(n => n !== id) : [...prev, id]);
            };

            const hasPermission = (permId) => {
                if (selectedRole.permissions.includes('all')) return true;
                return selectedRole.permissions.includes(permId);
            };

            const hasAnyChildPermission = (node) => {
                if (selectedRole.permissions.includes('all')) return true;
                if (hasPermission(node.id)) return true;
                if (node.children) {
                    return node.children.some(child => hasAnyChildPermission(child));
                }
                return false;
            };

            const renderTreeNode = (node, level = 0) => {
                const isExpanded = expandedNodes.includes(node.id);
                const hasChildren = node.children && node.children.length > 0;
                const isFolder = node.icon === 'folder';
                const hasPerm = hasPermission(node.id);
                const hasChildPerm = hasAnyChildPermission(node);

                if (searchText && !node.name.includes(searchText) && !node.id.includes(searchText)) {
                    if (!hasChildren || !node.children.some(c => c.name.includes(searchText) || c.id.includes(searchText))) {
                        return null;
                    }
                }

                return (
                    <div key={node.id}>
                        <div 
                            className={`flex items-center gap-2 py-2 px-3 rounded-lg cursor-pointer transition-all hover:bg-slate-50 ${hasPerm || hasChildPerm ? '' : 'opacity-40'}`}
                            style={{ paddingLeft: `${level * 20 + 12}px` }}
                            onClick={() => hasChildren && toggleExpand(node.id)}
                        >
                            {hasChildren ? (
                                <span className="text-slate-400 w-4">
                                    {isExpanded ? <ChevronDown size={14} /> : <ChevronRight size={14} />}
                                </span>
                            ) : <span className="w-4" />}
                            
                            {isFolder ? (
                                <Folder size={16} className="text-amber-500" />
                            ) : (
                                <File size={16} className="text-slate-400" />
                            )}
                            
                            <span className={`flex-1 text-sm ${isFolder ? 'font-medium text-slate-700' : 'text-slate-600'}`}>
                                {node.name}
                            </span>
                            
                            {node.type === 'action' && (
                                <span className={`w-5 h-5 rounded flex items-center justify-center ${hasPerm ? 'bg-green-100 text-green-600' : 'bg-slate-100 text-slate-300'}`}>
                                    <Check size={12} />
                                </span>
                            )}
                            
                            {node.type === 'menu' && (
                                <span className="px-2 py-0.5 bg-indigo-50 text-indigo-600 text-[10px] rounded">菜单</span>
                            )}
                        </div>
                        
                        {hasChildren && isExpanded && (
                            <div className="animate-fade-in">
                                {node.children.map(child => renderTreeNode(child, level + 1))}
                            </div>
                        )}
                    </div>
                );
            };

            return (
                <div className="p-8 max-w-[1400px] mx-auto animate-fade-in">
                    <div className="mb-8">
                        <h2 className="text-2xl font-bold text-slate-800 flex items-center gap-3">
                            <div className="w-10 h-10 rounded-xl bg-blue-100 flex items-center justify-center">
                                <Key size={20} className="text-blue-600" />
                            </div>
                            权限管理
                        </h2>
                        <p className="text-slate-500 text-sm mt-1 ml-13">查看和管理系统功能权限配置</p>
                    </div>

                    <div className="grid grid-cols-12 gap-6">
                        {/* 角色选择 */}
                        <div className="col-span-3 bg-white rounded-[2rem] shadow-sm border border-slate-100 overflow-hidden">
                            <div className="p-6 border-b border-slate-100">
                                <h3 className="font-bold text-slate-800">选择角色</h3>
                                <p className="text-xs text-slate-400 mt-1">查看角色权限配置</p>
                            </div>
                            <div className="p-4 space-y-2">
                                {ROLES.map(role => (
                                    <div 
                                        key={role.id}
                                        onClick={() => setSelectedRole(role)}
                                        className={`p-3 rounded-xl cursor-pointer transition-all ${selectedRole.id === role.id ? 'bg-indigo-50 border-2 border-indigo-200' : 'bg-slate-50 border-2 border-transparent hover:bg-slate-100'}`}
                                    >
                                        <div className="font-medium text-slate-700 text-sm">{role.name}</div>
                                        <div className="text-xs text-slate-400 mt-1">
                                            {role.permissions.includes('all') ? '全部权限' : `${role.permissions.length} 项权限`}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>

                        {/* 权限树 */}
                        <div className="col-span-9 bg-white rounded-[2rem] shadow-sm border border-slate-100 overflow-hidden">
                            <div className="p-6 border-b border-slate-100 flex justify-between items-center">
                                <div>
                                    <h3 className="font-bold text-slate-800">权限配置 - {selectedRole.name}</h3>
                                    <p className="text-xs text-slate-400 mt-1">绿色勾选表示已授权</p>
                                </div>
                                <div className="relative">
                                    <Search size={16} className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400" />
                                    <input 
                                        type="text" 
                                        placeholder="搜索权限..." 
                                        value={searchText}
                                        onChange={e => setSearchText(e.target.value)}
                                        className="pl-9 pr-4 py-2 bg-slate-50 rounded-xl text-sm w-48 outline-none focus:ring-2 focus:ring-indigo-100"
                                    />
                                </div>
                            </div>
                            <div className="p-4 max-h-[600px] overflow-y-auto">
                                {selectedRole.permissions.includes('all') && (
                                    <div className="mb-4 p-4 bg-red-50 rounded-xl border border-red-100 text-red-600 text-sm flex items-center gap-2">
                                        <Key size={16} /> 超级管理员拥有系统所有权限
                                    </div>
                                )}
                                {PERMISSION_TREE.map(node => renderTreeNode(node))}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
